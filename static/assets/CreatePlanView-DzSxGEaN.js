import{i as N,f as o,a as r,c as i,b as e,u as F,e as T,w as k,v as S,h as _,F as I,r as U,t as c,n as j,g as z}from"./index-Dt4hLyz-.js";import{u as B}from"./plan-C4_nWncI.js";import{s as R}from"./plans-CWatqful.js";import{s as O}from"./locations-CCAFugoJ.js";import"./client-Be4OVhjz.js";const E={class:"max-w-lg mx-auto mt-8"},K={class:"glass-panel rounded-2xl shadow-xl p-8 animate-fade-in"},M={class:"flex justify-between items-center mb-8"},q={class:"space-y-6"},A={class:"relative"},G={key:0,class:"relative"},H={key:1,class:"absolute z-10 left-0 right-0 rounded-xl shadow-lg mt-1 max-h-48 overflow-y-auto",style:{background:"var(--modal-bg)",border:"1px solid var(--border-color)"}},J=["onClick"],Q={class:"min-w-0"},W={class:"font-medium text-sm t-text truncate"},X={class:"text-xs t-text-muted truncate"},Y={key:2,class:"mt-2 rounded-lg px-3 py-2 flex items-center justify-between",style:{background:"var(--nav-active-bg)",border:"1px solid rgba(6,182,212,0.2)"}},Z={class:"flex items-center gap-2 min-w-0"},tt={class:"text-sm font-medium text-cyan-600 truncate"},et={class:"grid grid-cols-2 gap-4"},st=["disabled"],ut={__name:"CreatePlanView",setup(at){const D=z(),b=N(),p=B(),m=o(new Date().toISOString().split("T")[0]),u=o(1),v=o(""),f=o([]),l=o(null),x=o(!1),d=o(!1);let y=null;function C(s){if(y&&clearTimeout(y),!s.trim()){x.value=!1;return}y=setTimeout(async()=>{x.value=!0,f.value=[];try{f.value=await O(s)}catch(t){console.error(t)}},400)}function $(s){l.value={name:s.name,address:s.address,city:s.city||s.district||"",lat:s.location?parseFloat(s.location.split(",")[1]):null,lng:s.location?parseFloat(s.location.split(",")[0]):null},x.value=!1}function L(){l.value=null,v.value=""}async function P(){if(!l.value){b.showToast("请先搜索并选择出发起点","error");return}d.value=!0;const s=l.value,t=new Date(m.value).toLocaleDateString("zh-CN",{month:"long",day:"numeric"}),a=s.city||"",g=a?`${a} · ${t}出发 · ${u.value}日旅行`:`${t}出发 · ${u.value}日旅行`,w=[];let h=new Date(m.value);for(let n=0;n<u.value;n++)w.push({day_index:n+1,date:h.toISOString().split("T")[0],city:s.city||"",segments:[]}),h.setDate(h.getDate()+1);const V={title:g,days:w,start_location:{name:s.name,lat:s.lat,lng:s.lng,address:s.address,city:s.city}};try{const n=await R(V);b.showToast("行程创建成功"),p.activePlan=n,p.activePlan.days||(p.activePlan.days=[]),p.tempStartLocation=s,D.push({name:"plan-detail",params:{id:n.id}})}catch{b.showToast("创建失败","error")}finally{d.value=!1}}return(s,t)=>(r(),i("div",E,[e("div",K,[e("div",M,[t[6]||(t[6]=e("h2",{class:"text-3xl font-bold t-heading"},"创建新行程",-1)),e("button",{onClick:t[0]||(t[0]=a=>F(D).push({name:"plans"})),class:"t-text-muted hover:text-cyan-500 transition"},[...t[5]||(t[5]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("div",q,[e("div",A,[t[11]||(t[11]=e("label",{class:"block text-sm font-bold t-text-sub uppercase tracking-wider mb-2"},[T("出发起点 "),e("span",{class:"text-red-400"},"*")],-1)),l.value?_("",!0):(r(),i("div",G,[t[7]||(t[7]=e("i",{class:"fas fa-location-dot absolute left-4 top-1/2 -translate-y-1/2 t-text-muted"},null,-1)),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a),type:"text",placeholder:"搜索出发地点（如酒店、火车站、小区）",class:"w-full pl-11 pr-4 py-3 rounded-xl border outline-none transition",onInput:t[2]||(t[2]=a=>C(v.value)),autocomplete:"off"},null,544),[[S,v.value]])])),x.value&&f.value.length>0?(r(),i("div",H,[(r(!0),i(I,null,U(f.value,(a,g)=>(r(),i("div",{key:g,onClick:w=>$(a),class:"px-4 py-2.5 cursor-pointer transition flex items-center gap-3",style:{"border-bottom":"1px solid var(--border-subtle)"}},[t[8]||(t[8]=e("i",{class:"fas fa-map-pin t-text-muted flex-shrink-0"},null,-1)),e("div",Q,[e("div",W,c(a.name),1),e("div",X,c(a.district||"")+" "+c(a.address||""),1)])],8,J))),128))])):_("",!0),l.value?(r(),i("div",Y,[e("div",Z,[t[9]||(t[9]=e("i",{class:"fas fa-check-circle text-cyan-500 flex-shrink-0"},null,-1)),e("span",tt,c(l.value.name),1)]),e("button",{onClick:L,class:"t-text-muted hover:text-red-500 transition text-sm flex-shrink-0 ml-2 cursor-pointer"},[...t[10]||(t[10]=[e("i",{class:"fas fa-times"},null,-1)])])])):_("",!0)]),e("div",et,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-bold t-text-sub uppercase tracking-wider mb-2"},"出发日期",-1)),k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>m.value=a),type:"date",class:"w-full rounded-xl px-4 py-3 outline-none border transition"},null,512),[[S,m.value]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-bold t-text-sub uppercase tracking-wider mb-2"},"旅行天数",-1)),k(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>u.value=a),type:"number",min:"1",max:"30",class:"w-full rounded-xl px-4 py-3 outline-none border transition font-bold text-center text-lg"},null,512),[[S,u.value,void 0,{number:!0}]])])]),t[14]||(t[14]=e("p",{class:"text-xs t-text-muted leading-relaxed"},[e("i",{class:"fas fa-info-circle mr-1"}),T(" 设置出发起点后，可在行程编辑器中继续搜索添加游玩目的地 ")],-1)),e("button",{onClick:P,disabled:d.value,class:"w-full bg-gradient-to-r from-cyan-600 to-blue-600 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-cyan-500/30 hover:shadow-cyan-500/50 transform hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 disabled:opacity-50"},[e("span",null,c(d.value?"创建中...":"创建并编辑"),1),e("i",{class:j(["fas",d.value?"fa-spinner fa-spin":"fa-arrow-right"])},null,2)],8,st)])])]))}};export{ut as default};
